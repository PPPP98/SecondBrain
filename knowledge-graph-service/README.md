## Knowledge Graph Service

κ°„λ‹¨ν•κ³  μ‹¤μ©μ μΌλ΅ μ •λ¦¬ν• λ¦¬ν¬μ§€ν† λ¦¬ μ„¤λ…μ„μ…λ‹λ‹¤. μ΄ ν”„λ΅μ νΈλ” κ°μΈ λ…ΈνΈλ¥Ό μ„λ² λ”©ν•κ³  μ μ‚¬λ„ κΈ°λ°μΌλ΅ λ…ΈνΈλ“¤μ„ μ—°κ²°ν•΄ Neo4j μ§€μ‹ κ·Έλν”„λ¥Ό κµ¬μ„±ν•©λ‹λ‹¤.

ν„μ¬ μƒνƒ
- API μ„λ²„ (FastAPI) λ™μ‘
- μ›μ»¤(Background consumer) κµ¬μ„± μ™„λ£ β€” RabbitMQλ΅ λ©”μ‹μ§€λ¥Ό λ°›μ•„ μ²λ¦¬ν•©λ‹λ‹¤

μ£Όμ” λ³€κ²½/κ°„μ†ν™”
- μµμ† Python λ²„μ „: 3.13+

κΈ°μ  μ¤νƒ(μ”μ•½)
- Python 3.13+
- FastAPI, Uvicorn
- Neo4j (5.26)
- RabbitMQ + pika (μ›μ»¤μ—μ„ μ‚¬μ©)
- μμ΅΄μ„± κ΄€λ¦¬: `uv` (pyproject.toml, uv.lock)

ν”„λ΅μ νΈ ν•µμ‹¬ νμΌ
- `main.py` β€” FastAPI μ§„μ…μ 
- `worker.py` β€” μ›μ»¤ μ‹¤ν–‰ μ¤ν¬λ¦½νΈ (app.workers.note_consumer μ‚¬μ©)
- `pyproject.toml`, `uv.lock` β€” μμ΅΄μ„±
- `Dockerfile`, `Dockerfile.worker`, `docker-compose-test-kgservice.yml` β€” μ»¨ν…μ΄λ„ μ„¤μ •

λΉ λ¥Έ μ‹μ‘ (κ°λ°)
1) μμ΅΄μ„± μ„¤μΉ

```bash
uv sync
```

2) λ΅μ»¬ μ‹¤ν–‰ (API)

```bash
uv run python main.py
# μ„λ²„: http://localhost:8000/ai
```

3) λ΅μ»¬ μ›μ»¤ μ‹¤ν–‰

```bash
uv run python worker.py
```

λ„μ»¤(κ¶μ¥) β€” docker-compose-test-kgservice.yml μ‚¬μ©

```bash
docker-compose -f docker-compose-test-kgservice.yml build --no-cache
docker-compose -f docker-compose-test-kgservice.yml up -d
```

μ›μ»¤ λ΅κ·Έ λ³΄κΈ°

```bash
docker-compose -f docker-compose-test-kgservice.yml logs -f worker
```


## π― μ£Όμ” κΈ°λ¥ μ„¤λ…

### 1. μλ™ μ„λ² λ”© μƒμ„±

- λ…ΈνΈ μ‘μ„±μ‹ λ…ΈνΈ λ‚΄μ©μ— λ€ν•΄ μλ™μΌλ΅ μ„λ² λ”© λ²΅ν„°κ°’μ΄ κ³„μ‚°λμ–΄ μ €μ¥λ©λ‹λ‹¤.

### 2. μ μ‚¬λ„ κΈ°λ° μλ™ μ—°κ²°

```
μƒ λ…ΈνΈ A μƒμ„±
     β†“
λ²΅ν„° μΈλ±μ¤ κ²€μƒ‰ (HNSW)
     β†“
Top-20 μ μ‚¬ λ…ΈνΈ μ¶”μ¶ (μ½”μ‚¬μΈ μ μ‚¬λ„)
     β†“
μ„κ³„κ°’ ν•„ν„°λ§ (score β‰¥ 0.70)
     β†“
μµλ€ 10κ° κ΄€κ³„ μƒμ„± (SIMILAR_TO)
     β†“
μ–‘λ°©ν–¥ κ΄€κ³„ μ„¤μ • (A β†” B)
```
### 3. μ”μ•½ μ—μ΄μ „νΈ
- ν¬λ΅¬ μµμ¤ν…μ…μ„ ν†µν•΄ url / text λ°μ΄ν„°λ¥Ό μΆ…ν•©ν•΄ ν•λ‚μ noteλ΅ μ €μ¥ν•λ” μ—μ΄μ „νΈ
- urlμ„ κ°€μ Έμ™€ νμ‹±ν•κ³  / textλ°μ΄ν„°μ™€ μΆ…ν•©ν•΄ LLMν™μ©ν•΄μ„ μƒλ΅μ΄ λ…ΈνΈλ΅ μƒμ„±

### 4. λ…ΈνΈ κ²€μƒ‰ μ—μ΄μ „νΈ
- μ‚¬μ©μκ°€ μ°Ύκ³ μν•λ” λλ” κ¶κΈν• λ‚΄μ©μ„ λ‚΄κ°€ μ €μ¥ν• SecondBrainμ—μ„ μ°Ύμ•„μ£Όλ” μ—μ΄μ „νΈ
- μμ—°μ–΄λ΅ μ…λ ¥ν•λ©΄ μ•λ§μ€ ν•„ν„°λ¥Ό μ μ©ν•λ” **λ™μ μΏΌλ¦¬**μ‘μ„± Agentκµ¬μ¶•(μμ‹: μ‹κ°„ λ²”μ„)
- μ μ‚¬λ„ κ²€μƒ‰μ„ μ„ν• κ²€μƒ‰ μΏΌλ¦¬ μ¬μ‘μ„± μ΄ν›„ κ΄€λ ¨μ„± μ²΄ν¬ν•λ” Agent
- μµμΆ… μ‘λ‹µ μƒμ„± Agent
- Agent μ¤μΌ€μ¤νΈλΌ : LangGraph ν™μ©

![alt text](/knowledge-graph-service/docs/image.png)

### 5. κ·Έλν”„ κ΄€λ ¨ API
- κ·Έλν”„ μ‹κ°ν™”λ¥Ό μ„ν• Neo4j κ·Έλν”„ λ°μ΄ν„° μ κ³µ
- μ΄μ›ƒ λ…Έλ“ μ΅°ν
- MCP ν™μ© κ·Έλν”„ κ²€μƒ‰ μ κ³µ 


## β™οΈ μ„¤μ • μµμ…

### config.py μ£Όμ” μ„¤μ •

| μ„¤μ • | κΈ°λ³Έκ°’ | μ„¤λ… |
|-----|-------|------|
| `SIMILARITY_THRESHOLD` | 0.70 | κ΄€κ³„ μƒμ„± μµμ† μ μ‚¬λ„ |
| `MAX_RELATIONSHIPS` | 10 | λ…ΈνΈλ‹Ή μµλ€ μ—°κ²° μ |

### μ„κ³„κ°’ μ΅°μ • κ°€μ΄λ“
* μ„μ‹λ΅ μ‘μ„±λμ—μµλ‹λ‹¤ - μ•„μ§ ν™•μΈλ λ‚΄μ© μ•„λ‹
- **0.80 μ΄μƒ**: κ±°μ λ™μΌν• μ£Όμ  (λ§¤μ° μ—„κ²©)
- **0.70 - 0.79**: μ μ‚¬ν• μ£Όμ  (κ¶μ¥)
- **0.60 - 0.69**: κ΄€λ ¨λ μ£Όμ  (λμ¨ν•¨)
- **0.60 λ―Έλ§**: κ΄€λ ¨ μ—†μ

### λΉ„λ™κΈ° μ²λ¦¬ μ¶”κ°€

```
Spring Boot Backend
     β†“ (λ…ΈνΈ μ €μ¥)
PostgreSQL
     β†“ (λ©”μ‹μ§€ λ°ν–‰)
RabbitMQ
     β†“ (λ©”μ‹μ§€ μμ‹ )
Knowledge Graph Service
     β†“
Neo4j
```