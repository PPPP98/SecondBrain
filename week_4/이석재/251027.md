## TIL - 노트 서비스 아키텍처 개선 및 검색 전략

- 서비스의 핵심 기능인 노트 검색과 추천(연결) 로직에 대한 구체적인 아키텍처를 설계 및 고려 중


1. 주요 기술 스택 확정

    초기 구상에서 일부 변경. Milvus 사용은 일단 보류

    PostgreSQL: 메인 데이터베이스 (사용자, 노트 원본, 리마인더 등 RDB 데이터)

    Neo4j: 그래프 관계 및 벡터 검색. Neo4j 5.x 버전 이상부터 강력한 벡터 인덱스 및 검색 기능을 기본 제공한다. 우선 Neo4j로 구현해보고, 추후 노트 데이터가 방대해져 벡터 검색 속도에 병목이 생길 경우 Milvus 도입을 재검토한다.

    Elasticsearch : 전문 검색(Full-text search) 엔진

    Redis: 캐싱 및 세션 관리


2. 전문 검색(Full-text Search) 도입

    목표: 사용자가 작성한 노트 본문 내의 키워드를 빠르고 정확하게 검색

    방안: Elasticsearch(ES)를 도입

    프로세스: PostgreSQL에 노트가 생성/수정될 때마다 해당 데이터를 ES에도 동기화한다. (Kafka 같은 메시지 큐를 사용한 비동기 방식 또는 Logstash 고려)

    역할: ES는 '키워드' 기반의 빠른 텍스트 검색을 전담


3. 노트 간 연결 로직 (하이브리드 점수 모델)

    Neo4j에 노트 노드 간의 관계([:RELATED])를 맺는 기준을 명확히 정의.

    목표: 단순 키워드나 벡터만으론 부족. '의미(Vector)'와 '주제(Tag)'를 모두 고려한 정교한 연결 생성.

    하이브리드 점수(Hybrid Score) 모델:

    최종 점수 = (벡터 유사도 점수 * 0.7) + (태그 일치 점수 * 0.3)

    벡터 유사도 (0.7): Neo4j 벡터 인덱스를 통해 계산된 코사인 유사도 (0~1).

    태그 일치 점수 (0.3): (일치하는 태그 갯수 / 5) * 0.3 (태그가 총 5개라는 가정 하) 또는 (일치 태그 갯수 * 0.06) (태그 1개당 0.06점, 5개면 0.3 만점)

    실행: 이 최종 점수가 우리가 설정한 임계값(Threshold) 이상일 경우에만 두 노트 노드 사이에 관계를 생성


4. 사용자 검색 기능 (구글 익스텐션)

    사용자가 구글 검색창에 입력한 키워드를 활용해, 즉시 자신의 노트를 추천하는 기능.

    목표: 빠르고 정확한 '내 노트' 추천.

    방안: 하이브리드 검색 (Hybrid Search) 적용.

    프로세스:

    사용자가 익스텐션(또는 검색창)에 '검색어' 입력.

    1차 (ES): '검색어'를 Elasticsearch에 보내 키워드가 일치하는 노트 목록을 빠르게 필터링 (Lexical Search).

    2차 (Neo4j): '검색어'를 벡터로 임베딩하여 Neo4j에 보내 의미가 유사한 노트 목록을 검색 (Semantic Search).

    두 결과를 재조합(Rerank)하여 사용자에게 가장 연관성 높은 노트를 최종 추천.