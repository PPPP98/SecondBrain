TIL: Elasticsearch 7 핵심 정리 (MVP 노트 검색)

우리 서비스의 노트 검색 속도를 잡으려면 RDB만으로는 안되어 MVP 검색 기능 구현을 위해 Elasticsearch 7 버전을 학습했음

1. ES가 왜 빠른가? (핵심: 역색인)


    RDB는 책의 첫 장부터 끝까지 다 읽어보는 식(Full Scan)

    ES는 책 맨 뒤의 '찾아보기'(Index)를 이용하는 식

    이 '찾아보기'를 역색인(Inverted Index)이라고 부름

    "A"라는 단어가 1번, 5번 노트에 있다고 미리 목록을 만들어 둠

    그래서 'A'를 검색하면 바로 1번, 5번 노트를 가져올 수 있음


2. 용어 정리 (RDB vs ES 7)


    Database -> (비슷한 거 없음)

    Table -> Index (데이터 저장소의 큰 단위)

    Row -> Document (JSON 객체 하나)

    Column -> Field (JSON의 Key)

    Schema -> Mapping (데이터 타입 정의)

    (ES7의 Type은 v8에서 사라지니 _doc으로 통일하고 신경 끄자)


3. 한글 검색을 위한 필수 설정 (Mapping, Analyzer)


    이게 제일 중요했다. 그냥 넣으면 한글 검색이 제대로 안 됨

    Analyzer (분석기):

    '노트 검색'이란 텍스트를 '노트'와 '검색'으로 쪼개주는 부품

    기본 분석기는 한글을 제대로 못 쪼갬 (예: '노트검색'을 통으로 인식).

    ES 7에 nori라는 한글 분석기 플러그인을 꼭 설치해야 함

    Mapping (데이터 타입 정의):

    text: nori 같은 분석기가 필요한 필드. (본문 내용, 제목)

    keyword: 완전 일치 검색이 필요한 필드. (noteId, 태그)

    이 두 개를 헷갈리면 검색 결과가 이상하게 나옴


4. 검색 쿼리 (Query DSL)


    ES는 SQL 대신 JSON 형태의 Query DSL을 쓴다.

    MVP (텍스트 검색):

    match 쿼리를 사용.

    {"query": {"match": {"content": "검색할 단어"}}}

    이게 nori 분석기를 통해 역색인을 뒤져서 결과를 찾아줌

    향후 (하이브리드 검색):

    우리 목표인 '텍스트 검색 + 벡터 유사도'를 합치는 방법

    맵핑에 dense_vector 타입을 추가해서 벡터값 저장

    script_score 쿼리를 사용

    match 점수랑 cosineSimilarity (벡터 유사도 함수) 점수를 스크립트로 조합

    (예: (텍스트 점수 * 0.3) + (벡터 점수 * 0.7))
---

요약 :
    nori 플러그인 설치가 급선무

    Mapping 설계 시 text와 keyword 구분이 중요

    MVP는 match 쿼리로 구현 시작

    하이브리드는 dense_vector와 script_score가 키워드